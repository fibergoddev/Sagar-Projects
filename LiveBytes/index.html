<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveBytes - Professional Live Classes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }
        .active .modal-backdrop, .active .modal {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Main Container -->
    <div id="app" class="min-h-screen flex flex-col">

        <!-- Header -->
        <header class="bg-white shadow-md w-full p-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fas fa-satellite-dish text-2xl text-indigo-600"></i>
                <h1 class="text-2xl font-bold text-gray-800">LiveBytes</h1>
            </div>
            <div class="flex items-center space-x-4">
                <span id="user-greeting" class="hidden md:block font-medium">Hello, Guest!</span>
                <div class="relative">
                    <button id="profile-button" class="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center">
                        <i class="fas fa-user"></i>
                    </button>
                    <!-- Profile Dropdown -->
                    <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                        <a href="#" id="logout-button" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto p-4 md:p-8">
            
            <!-- Login/Auth Screen -->
            <div id="auth-screen" class="text-center max-w-md mx-auto mt-16">
                 <i class="fas fa-lock text-5xl text-indigo-500 mb-4"></i>
                 <h2 class="text-3xl font-bold mb-2">Welcome to LiveBytes</h2>
                 <p class="text-gray-600 mb-8">Please sign in to continue.</p>
                 <button id="login-button" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 shadow-lg">
                     <i class="fas fa-sign-in-alt mr-2"></i> Sign In Anonymously
                 </button>
                 <p class="text-xs text-gray-500 mt-4">Your User ID will be generated automatically.</p>
            </div>

            <!-- Dashboard Screen -->
            <div id="dashboard-screen" class="hidden">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold">Dashboard</h2>
                    <p class="text-gray-600 mt-2">Manage your classes or join a session.</p>
                    <div class="mt-4 text-sm text-gray-500">Your User ID: <span id="user-id-display" class="font-mono bg-gray-200 px-2 py-1 rounded"></span></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Teacher Section -->
                    <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-2xl font-bold mb-6 text-center">For Teachers</h3>
                        <div class="space-y-4">
                            <button id="create-class-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 shadow-lg">
                                <i class="fas fa-plus-circle mr-2"></i> Create a New Class
                            </button>
                            <button class="w-full bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition duration-300">
                                <i class="fas fa-chalkboard-teacher mr-2"></i> Manage My Classes
                            </button>
                        </div>
                    </div>

                    <!-- Student Section -->
                    <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-2xl font-bold mb-6 text-center">For Students</h3>
                        <div class="space-y-4">
                            <div class="relative">
                                <i class="fas fa-link absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="class-code-input" placeholder="Enter Class Code or Link" class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                            </div>
                            <button id="join-class-btn" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition duration-300 shadow-lg">
                                <i class="fas fa-sign-in-alt mr-2"></i> Join Class
                            </button>
                        </div>
                    </div>
                </div>
            </div>

             <!-- Live Class Screen -->
            <div id="live-class-screen" class="hidden">
                <!-- This will be populated with video streams, chat, etc. -->
                 <div class="bg-gray-900 text-white p-4 rounded-lg">
                    <h2 class="text-2xl font-bold">Live Class in Session</h2>
                    <p>Class Code: <span id="live-class-code" class="font-mono"></span></p>
                    <!-- Video, chat, etc. will go here -->
                 </div>
            </div>
        </main>
    </div>

    <!-- Create Class Modal -->
    <div id="create-class-modal-container" class="active">
        <div class="modal-backdrop"></div>
        <div id="create-class-modal" class="modal bg-white w-11/12 md:max-w-md p-8 rounded-xl shadow-2xl">
            <h3 class="text-2xl font-bold mb-6">Create New Class</h3>
            <form id="create-class-form">
                <div class="mb-4">
                    <label for="class-name" class="block text-sm font-medium text-gray-700 mb-1">Class Name</label>
                    <input type="text" id="class-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div class="mb-6">
                    <label for="class-schedule" class="block text-sm font-medium text-gray-700 mb-1">Schedule (Optional)</label>
                    <input type="datetime-local" id="class-schedule" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancel-create-class" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Create</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCRtGY2tNdVLzRzFCu8zjtBfIJFAx03x0U",
            authDomain: "livebytes9.firebaseapp.com",
            projectId: "livebytes9",
            storageBucket: "livebytes9.appspot.com",
            messagingSenderId: "850298480640",
            appId: "1:850298480640:web:df091fa72415573a2e90e5",
            measurementId: "G-40RTZ1MLP5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- UI Elements ---
        const authScreen = document.getElementById('auth-screen');
        const dashboardScreen = document.getElementById('dashboard-screen');
        const liveClassScreen = document.getElementById('live-class-screen');
        const loginButton = document.getElementById('login-button');
        const createClassBtn = document.getElementById('create-class-btn');
        const joinClassBtn = document.getElementById('join-class-btn');
        const createClassModalContainer = document.getElementById('create-class-modal-container');
        const createClassModal = document.getElementById('create-class-modal');
        const cancelCreateClassBtn = document.getElementById('cancel-create-class');
        const createClassForm = document.getElementById('create-class-form');
        const profileButton = document.getElementById('profile-button');
        const profileDropdown = document.getElementById('profile-dropdown');
        const userIdDisplay = document.getElementById('user-id-display');
        const userGreeting = document.getElementById('user-greeting');

        // --- App State ---
        let currentUser = null;

        // --- Authentication ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in.
                currentUser = user;
                showDashboard();
                userIdDisplay.textContent = user.uid;
                userGreeting.textContent = `Hello, User!`;
                userGreeting.classList.remove('hidden');
            } else {
                // User is signed out.
                currentUser = null;
                showAuthScreen();
                userGreeting.classList.add('hidden');
            }
        });

        loginButton.addEventListener('click', () => {
            signInAnonymously(auth).catch((error) => {
                console.error("Anonymous sign-in failed:", error);
                alert("Could not sign in. Please try again.");
            });
        });

        // --- UI Logic ---
        function showAuthScreen() {
            authScreen.classList.remove('hidden');
            dashboardScreen.classList.add('hidden');
            liveClassScreen.classList.add('hidden');
        }

        function showDashboard() {
            authScreen.classList.add('hidden');
            dashboardScreen.classList.remove('hidden');
            liveClassScreen.classList.add('hidden');
        }

        function showLiveClassScreen(classCode) {
            authScreen.classList.add('hidden');
            dashboardScreen.classList.add('hidden');
            liveClassScreen.classList.remove('hidden');
            document.getElementById('live-class-code').textContent = classCode;
        }

        // Profile Dropdown Toggle
        profileButton.addEventListener('click', (e) => {
            e.stopPropagation();
            profileDropdown.classList.toggle('hidden');
        });

        document.addEventListener('click', () => {
            profileDropdown.classList.add('hidden');
        });


        // --- Modal Logic ---
        function openCreateClassModal() {
            createClassModalContainer.classList.add('active');
        }

        function closeCreateClassModal() {
            createClassModalContainer.classList.remove('active');
            createClassForm.reset();
        }

        createClassBtn.addEventListener('click', openCreateClassModal);
        cancelCreateClassBtn.addEventListener('click', closeCreateClassModal);
        createClassModalContainer.querySelector('.modal-backdrop').addEventListener('click', closeCreateClassModal);

        // --- Class Management ---
        createClassForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) {
                alert("You must be signed in to create a class.");
                return;
            }

            const className = document.getElementById('class-name').value;
            const classCode = generateClassCode();
            
            try {
                // Store class data in Firestore
                const classRef = doc(db, "classes", classCode);
                await setDoc(classRef, {
                    name: className,
                    teacherId: currentUser.uid,
                    createdAt: new Date(),
                    students: []
                });
                
                alert(`Class created successfully! Your class code is: ${classCode}`);
                closeCreateClassModal();
                // For now, we just show an alert. Later we'll redirect to the class management page.
            } catch (error) {
                console.error("Error creating class:", error);
                alert("Failed to create class. Please try again.");
            }
        });

        joinClassBtn.addEventListener('click', async () => {
            const classCode = document.getElementById('class-code-input').value.trim();
            if (!classCode) {
                alert("Please enter a class code.");
                return;
            }
            if (!currentUser) {
                alert("You must be signed in to join a class.");
                return;
            }
            
            // Check if class exists
            const classRef = doc(db, "classes", classCode);
            const classSnap = await getDoc(classRef);

            if (classSnap.exists()) {
                // For now, just switch to the live class view
                showLiveClassScreen(classCode);
                // In a real app, you would add the student to the class document
                // and then establish a real-time connection.
            } else {
                alert("Class not found. Please check the code and try again.");
            }
        });


        function generateClassCode() {
            // Simple 6-digit code generator
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // Initially hide the modal container
        createClassModalContainer.classList.remove('active');

    </script>
</body>
</html>
